<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chimalhua-CAN - Cuenta de Veterinario</title>
    <link rel="icon" href="img/logo.jpeg">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-storage.js"></script>
</head>
<body class="bg-gray-100 font-sans flex flex-col min-h-screen">
    <header class="bg-white shadow-md">
        <div class="container mx-auto px-4 py-6 flex flex-col md:flex-row items-center justify-between">
            <div class="flex items-center mb-4 md:mb-0">
                <img src="img/logo.jpeg" alt="Chimalhua-CAN Logo" class="h-12 w-12 mr-4 rounded-full">
                <h1 class="text-2xl font-bold text-gray-800">Chimalhua-CAN</h1>
                <span id="nombre-usuario" class="ml-4 text-lg font-semibold text-gray-600"></span>
            </div>
            <nav>
                <ul class="flex space-x-6">
                    <li><a href="#" onclick="mostrarSeccion('inicio')" class="text-gray-600 hover:text-gray-800 transition duration-300">Inicio</a></li>
                    <li><a href="#" onclick="mostrarSeccion('citas')" class="text-gray-600 hover:text-gray-800 transition duration-300">Citas</a></li>
                    <li><a href="#" onclick="mostrarSeccion('clientes')" class="text-gray-600 hover:text-gray-800 transition duration-300">Clientes</a></li>
                    <li><a href="#" onclick="mostrarSeccion('tienda')" class="text-gray-600 hover:text-gray-800 transition duration-300">Tienda</a></li>
                    <li><a href="#" onclick="mostrarSeccion('inventario')" class="text-gray-600 hover:text-gray-800 transition duration-300">Inventario</a></li>
                    <li><a href="#" onclick="mostrarSeccion('servicios')" class="text-gray-600 hover:text-gray-800 transition duration-300">Servicios</a></li>
                    <li><a href="#" onclick="mostrarSeccion('expedientes')" class="text-gray-600 hover:text-gray-800 transition duration-300">Expedientes</a></li>
                    <li><a href="#" onclick="mostrarSeccion('perfil')" class="text-gray-600 hover:text-gray-800 transition duration-300">Mi Perfil</a></li>
                    <li><a href="#" onclick="cerrarSesion()" class="text-gray-600 hover:text-gray-800 transition duration-300">Cerrar Sesión</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <main class="container mx-auto px-4 py-12 flex-grow">
        <div id="seccion-inicio" class="hidden">
            <h2 class="text-3xl font-bold text-center mb-8 text-gray-800">Bienvenido, Dr. <span id="nombre-veterinario"></span></h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-xl font-semibold mb-4">Próximas Citas</h3>
                    <div id="proximas-citas" class="space-y-4">
                        <!-- Las próximas citas se cargarán aquí dinámicamente -->
                    </div>
                </div>
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-xl font-semibold mb-4">Solicitudes de Servicios</h3>
                    <div id="solicitudes-servicios" class="space-y-4">
                        <!-- Las solicitudes de servicios se cargarán aquí dinámicamente -->
                    </div>
                </div>
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-xl font-semibold mb-4">Resumen de Pacientes</h3>
                    <div id="resumen-pacientes" class="space-y-4">
                        <!-- El resumen de pacientes se cargará aquí dinámicamente -->
                    </div>
                </div>
            </div>
        </div>

        <div id="seccion-citas" class="hidden">
            <h2 class="text-3xl font-bold text-center mb-8 text-gray-800">Gestión de Citas</h2>
            <div class="bg-white rounded-lg shadow-md p-6">
                <div id="lista-citas" class="space-y-4">
                    <!-- Las citas se cargarán aquí dinámicamente -->
                </div>
            </div>
        </div>

        <div id="seccion-clientes" class="hidden">
            <h2 class="text-3xl font-bold text-center mb-8 text-gray-800">Gestión de Clientes</h2>
            <div class="bg-white rounded-lg shadow-md p-6">
                <form id="form-cliente" class="mb-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label for="cliente-nombre" class="block text-gray-700 text-sm font-bold mb-2">Nombre Completo</label>
                            <input type="text" id="cliente-nombre" name="cliente-nombre" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" required pattern="^[a-zA-ZáéíóúÁÉÍÓÚñÑ\s]+$" title="Por favor, ingrese solo letras y espacios">
                        </div>
                        <div>
                            <label for="cliente-email" class="block text-gray-700 text-sm font-bold mb-2">Correo Electrónico</label>
                            <input type="email" id="cliente-email" name="cliente-email" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" required>
                        </div>
                        <div>
                            <label for="cliente-telefono" class="block text-gray-700 text-sm font-bold mb-2">Número de Teléfono</label>
                            <input type="tel" id="cliente-telefono" name="cliente-telefono" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" required pattern="[0-9]{10}" title="Por favor, ingrese un número de teléfono válido de 10 dígitos">
                        </div>
                        <div>
                            <label for="cliente-fijo" class="block text-gray-700 text-sm font-bold mb-2">Número Fijo</label>
                            <input type="tel" id="cliente-fijo" name="cliente-fijo" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" pattern="[0-9]{10}" title="Por favor, ingrese un número fijo válido de 10 dígitos">
                        </div>
                        <div class="md:col-span-2">
                            <label for="cliente-direccion" class="block text-gray-700 text-sm font-bold mb-2">Dirección</label>
                            <input type="text" id="cliente-direccion" name="cliente-direccion" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" required>
                        </div>
                    </div>
                    <button type="submit" class="mt-4 bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 transition duration-300">Agregar Cliente</button>
                </form>
                <div id="lista-clientes" class="space-y-4">
                    <!-- Los clientes se cargarán aquí dinámicamente -->
                </div>
            </div>
        </div>

        <div id="seccion-tienda" class="hidden">
            <h2 class="text-3xl font-bold text-center mb-8 text-gray-800">Gestión de Tienda</h2>
            <div class="bg-white rounded-lg shadow-md p-6">
                <form id="form-producto" class="mb-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label for="producto-nombre" class="block text-gray-700 text-sm font-bold mb-2">Nombre del Producto</label>
                            <input type="text" id="producto-nombre" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" required>
                        </div>
                        <div>
                            <label for="producto-precio" class="block text-gray-700 text-sm font-bold mb-2">Precio</label>
                            <input type="number" id="producto-precio" step="0.01" min="0.01" max="1500" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" required>
                        </div>
                        <div>
                            <label for="producto-descripcion" class="block text-gray-700 text-sm font-bold mb-2">Descripción</label>
                            <textarea id="producto-descripcion" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" required></textarea>
                        </div>
                        <div>
                            <label for="producto-imagen" class="block text-gray-700 text-sm font-bold mb-2">Imagen</label>
                            <input type="file" id="producto-imagen" accept="image/*" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" required>
                        </div>
                    </div>
                    <button type="submit" class="mt-4 bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 transition duration-300">Agregar Producto</button>
                </form>
                <div id="lista-productos" class="space-y-4">
                    <!-- Los productos se cargarán aquí dinámicamente -->
                </div>
            </div>
        </div>

        <div id="seccion-inventario" class="hidden">
            <h2 class="text-3xl font-bold text-center mb-8 text-gray-800">Gestión de Inventario</h2>
            <div class="bg-white rounded-lg shadow-md p-6">
                <form id="form-inventario" class="mb-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label for="inventario-nombre" class="block text-gray-700 text-sm font-bold mb-2">Nombre del Producto</label>
                            <input type="text" id="inventario-nombre" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" required>
                        </div>
                        <div>
                            <label for="inventario-cantidad" class="block text-gray-700 text-sm font-bold mb-2">Cantidad</label>
                            <input type="number" id="inventario-cantidad" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" required>
                        </div>
                        <div>
                            <label for="inventario-precio" class="block text-gray-700 text-sm font-bold mb-2">Precio de Compra</label>
                            <input type="number" id="inventario-precio" step="0.01" min="0.01" max="1500" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" required>
                        </div>
                    </div>
                    <button type="submit" class="mt-4 bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600 transition duration-300">Agregar al Inventario</button>
                </form>
                <div id="lista-inventario" class="space-y-4">
                    <!-- Los items del inventario se cargarán aquí dinámicamente -->
                </div>
            </div>
        </div>

        <div id="seccion-servicios" class="hidden">
            <h2 class="text-3xl font-bold text-center mb-8 text-gray-800">Gestión de Servicios</h2>
            <div class="bg-white rounded-lg shadow-md p-6">
                <form id="form-servicio" class="mb-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label for="servicio-nombre" class="block text-gray-700  text-sm font-bold mb-2">Nombre del Servicio</label>
                            <input type="text" id="servicio-nombre" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" required>
                        </div>
                        <div>
                            <label for="servicio-precio" class="block text-gray-700 text-sm font-bold mb-2">Precio</label>
                            <input type="number" id="servicio-precio" step="0.01" min="0.01" max="1500" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" required>
                        </div>
                        <div>
                            <label for="servicio-descripcion" class="block text-gray-700 text-sm font-bold mb-2">Descripción</label>
                            <textarea id="servicio-descripcion" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" required></textarea>
                        </div>
                    </div>
                    <button type="submit" class="mt-4 bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 transition duration-300">Agregar Servicio</button>
                </form>
                <div id="lista-servicios" class="space-y-4">
                    <!-- Los servicios se cargarán aquí dinámicamente -->
                </div>
            </div>
        </div>

        <div id="seccion-expedientes" class="hidden">
            <h2 class="text-3xl font-bold text-center mb-8 text-gray-800">Expedientes de Pacientes</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="lista-expedientes">
                <!-- Expedientes will be loaded here dynamically -->
            </div>
        </div>

        <div id="seccion-perfil" class="hidden">
            <h2 class="text-3xl font-bold text-center mb-8 text-gray-800">Mi Perfil</h2>
            <div class="bg-white rounded-lg shadow-md p-6">
                <form id="form-perfil">
                    <div class="mb-4 flex justify-center">
                        <div class="relative">
                            <img id="foto-perfil" src="img/default-profile.png" alt="Foto de perfil" class="w-32 h-32 rounded-full object-cover">
                            <label for="input-foto-perfil" class="absolute bottom-0 right-0 bg-blue-500 text-white rounded-full p-2 cursor-pointer">
                                <i class="fas fa-camera"></i>
                            </label>
                            <input type="file" id="input-foto-perfil" accept="image/*" class="hidden" onchange="subirFotoPerfil(event)">
                        </div>
                    </div>
                    <div class="mb-4">
                        <label for="nombre" class="block text-gray-700 text-sm font-bold mb-2">Nombre</label>
                        <input type="text" id="nombre" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" required>
                    </div>
                    <div class="mb-4">
                        <label for="email" class="block text-gray-700 text-sm font-bold mb-2">Email</label>
                        <input type="email" id="email" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" required readonly>
                    </div>
                    <div class="mb-4">
                        <label for="especialidad" class="block text-gray-700 text-sm font-bold mb-2">Especialidad</label>
                        <input type="text" id="especialidad" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
                    </div>
                    <button type="submit" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 transition duration-300">Guardar Cambios</button>
                </form>
            </div>
        </div>
    </main>

    <footer class="bg-gray-800 text-white text-sm mt-auto">
        <div class="container mx-auto px-4 py-6">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div>
                    <h4 class="font-bold mb-2">Nos ubicamos en:</h4>
                    <p>Av. Saltillo s/n Esq. Calle Clavel Col. Jardines de San Agustín Chimalhuacán Edo. de Méx.</p>
                </div>
                <div>
                    <h4  class="font-bold mb-2">Horario:</h4>
                    <p>Lunes a Sábado: 10:00  a.m. - 7:00 p.m.</p>
                    <p>Domingos: 11:00 a.m. - 3:00 p.m.</p>
                </div>
                <div>
                    <h4 class="font-bold mb-2">Redes Sociales:</h4>
                    <div class="flex space-x-4">
                        <a href="https://www.facebook.com/profile.php?id=100063788671062&mibextid=ZbWKwL" class="hover:text-gray-300 transition duration-300">
                            <i class="fab fa-facebook-f"></i>
                        </a>
                        <a href="https://www.instagram.com/veterinaria_chimalhuacan?igsh=MXFrZnl6NWQ1aGVlbw==" class="hover:text-gray-300 transition duration-300">
                            <i class="fab fa-instagram"></i>
                        </a>
                        <a href="#" class="hover:text-gray-300 transition duration-300">
                            <i class="fab fa-whatsapp"></i>
                        </a>
                    </div>
                </div>
            </div>
            <div class="mt-4 text-center">
                <p>&copy; 2024 Team Master. All Rights Reserved</p>
            </div>
        </div>
    </footer>

    <script>
        // Configuración de Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyBhNGcipRymMP_1FFU2izi6Be2El2slG0E",
            authDomain: "chimalhua-can-dd624.firebaseapp.com",
            databaseURL: "https://chimalhua-can-dd624-default-rtdb.firebaseio.com",
            projectId: "chimalhua-can-dd624",
            storageBucket: "chimalhua-can-dd624.appspot.com",
            messagingSenderId: "138908575127",
            appId: "1:138908575127:web:8007d41d3970e76b8650d2"
        };

        // Inicializar Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const database = firebase.database();
        const storage = firebase.storage();

        let userId;

        // Verificar si el usuario está autenticado
        auth.onAuthStateChanged((user) => {
            if (user) {
                userId = user.uid;
                cargarDatosUsuario();
                mostrarSeccion('inicio');
            } else {
                window.location.href = 'iniciarS.html';
            }
        });

        function cargarDatosUsuario() {
            database.ref('usuarios/' + userId).once('value', (snapshot) => {
                const usuario = snapshot.val();
                document.getElementById('nombre-usuario').textContent = usuario.nombre || 'Veterinario';
                document.getElementById('nombre-veterinario').textContent = usuario.nombre || '';
                document.getElementById('nombre').value = usuario.nombre || '';
                document.getElementById('email').value = usuario.email || '';
                document.getElementById('especialidad').value = usuario.especialidad || '';
                if (usuario.fotoPerfil) {
                    document.getElementById('foto-perfil').src = usuario.fotoPerfil;
                }
                cargarProximasCitas();
                cargarSolicitudesServicios();
                cargarResumenPacientes();
            });
        }

        function mostrarSeccion(seccion) {
            document.querySelectorAll('main > div').forEach(div => div.classList.add('hidden'));
            document.getElementById(`seccion-${seccion}`).classList.remove('hidden');

            if (seccion === 'citas') {
                cargarCitas();
            } else if (seccion === 'clientes') {
                cargarClientes();
            } else if (seccion === 'tienda') {
                cargarProductos();
            } else if (seccion === 'inventario') {
                cargarInventario();
            } else if (seccion === 'servicios') {
                cargarServicios();
            } else if (seccion === 'expedientes') {
                cargarExpedientes();
            }
        }

        function cargarProximasCitas() {
            const citasContainer = document.getElementById('proximas-citas');
            citasContainer.innerHTML = '';
            database.ref('citas').orderByChild('fecha').startAt(new Date().toISOString().split('T')[0]).limitToFirst(5).once('value', (snapshot) => {
                if (snapshot.exists()) {
                    snapshot.forEach((childSnapshot) => {
                        const cita = childSnapshot.val();
                        const citaElement = document.createElement('div');
                        citaElement.className = 'bg-gray-100 p-4 rounded mb-2';
                        citaElement.innerHTML = `
                            <p><strong>Fecha:</strong> ${new Date(cita.fecha).toLocaleDateString()}</p>
                            <p><strong>Hora:</strong> ${cita.hora}</p>
                            <p><strong>Paciente:</strong> ${cita.nombreMascota || 'No especificado'}</p>
                            <p><strong>Motivo:</strong> ${cita.motivo}</p>
                        `;
                        citasContainer.appendChild(citaElement);
                    });
                } else {
                    citasContainer.innerHTML = '<p>No hay citas próximas.</p>';
                }
            });
        }

        function cargarSolicitudesServicios() {
            const solicitudesContainer = document.getElementById('solicitudes-servicios');
            solicitudesContainer.innerHTML = '';
            database.ref('solicitudes_servicios').orderByChild('fecha').startAt(new Date().toISOString().split('T')[0]).limitToFirst(5).once('value', (snapshot) => {
                if (snapshot.exists()) {
                    snapshot.forEach((childSnapshot) => {
                        const solicitud = childSnapshot.val();
                        const solicitudElement = document.createElement('div');
                        solicitudElement.className = 'bg-gray-100 p-4 rounded mb-2';
                        solicitudElement.innerHTML = `
                            <p><strong>Fecha:</strong> ${new Date(solicitud.fecha).toLocaleDateString()}</p>
                            <p><strong>Servicio:</strong> ${solicitud.nombreServicio}</p>
                            <p><strong>Cliente:</strong> ${solicitud.nombreCliente}</p>
                            <p><strong>Estado:</strong> ${solicitud.estado}</p>
                        `;
                        solicitudesContainer.appendChild(solicitudElement);
                    });
                } else {
                    solicitudesContainer.innerHTML = '<p>No hay solicitudes de servicios pendientes.</p>';
                }
            });
        }

        function cargarResumenPacientes() {
            const resumenContainer = document.getElementById('resumen-pacientes');
            resumenContainer.innerHTML = '';
            database.ref('mascotas').once('value', (snapshot) => {
                const totalPacientes = snapshot.numChildren();
                resumenContainer.innerHTML = `
                    <p><strong>Total de pacientes:</strong> ${totalPacientes}</p>
                    <p><strong>Pacientes activos:</strong> ${totalPacientes}</p>
                    <p><strong>Últimas consultas:</strong> 5</p>
                `;
            });
        }

        function cargarCitas() {
            const citasContainer = document.getElementById('lista-citas');
            citasContainer.innerHTML = '';
            database.ref('citas').orderByChild('fecha').startAt(new Date().toISOString().split('T')[0]).once('value', (snapshot) => {
                if (snapshot.exists()) {
                    snapshot.forEach((childSnapshot) => {
                        const cita = childSnapshot.val();
                        database.ref('usuarios/' + cita.usuarioId).once('value', (userSnapshot) => {
                            const usuario = userSnapshot.val();
                            const citaElement = document.createElement('div');
                            citaElement.className = 'bg-gray-100 p-4 rounded mb-2';
                            citaElement.innerHTML = `
                                <p><strong>Fecha:</strong> ${new Date(cita.fecha).toLocaleDateString()}</p>
                                <p><strong>Hora:</strong> ${cita.hora}</p>
                                <p><strong>Cliente:</strong> ${usuario.nombre}</p>
                                <p><strong>Paciente:</strong> ${cita.nombreMascota}</p>
                                <p><strong>Motivo:</strong> ${cita.motivo}</p>
                                <button onclick="atenderCita('${childSnapshot.key}')" class="mt-2 bg-blue-500 text-white px-2 py-1 rounded hover:bg-blue-600 transition duration-300">Atender</button>
                                <button onclick="reagendarCita('${childSnapshot.key}')" class="mt-2 bg-yellow-500 text-white px-2 py-1 rounded hover:bg-yellow-600 transition duration-300">Reagendar</button>
                                <button onclick="cancelarCita('${childSnapshot.key}')" class="mt-2 bg-red-500 text-white px-2 py-1 rounded hover:bg-red-600 transition duration-300">Cancelar</button>
                            `;
                            citasContainer.appendChild(citaElement);
                        });
                    });
                } else {
                    citasContainer.innerHTML = '<p>No hay citas programadas.</p>';
                }
            });
        }

        function cargarClientes() {
            const clientesContainer = document.getElementById('lista-clientes');
            clientesContainer.innerHTML = '';
            database.ref('clientes').once('value', (snapshot) => {
                if (snapshot.exists()) {
                    snapshot.forEach((childSnapshot) => {
                        const cliente = childSnapshot.val();
                        const clienteElement = document.createElement('div');
                        clienteElement.className = 'bg-gray-100 p-4 rounded mb-2';
                        clienteElement.innerHTML = `
                            <p><strong>Nombre:</strong> ${cliente.nombre}</p>
                            <p><strong>Email:</strong> ${cliente.email}</p>
                            <p><strong>Teléfono:</strong> ${cliente.telefono}</p>
                            <p><strong>Fijo:</strong>  ${cliente.fijo || 'No especificado'}</p>
                            <p><strong>Dirección:</strong> ${cliente.direccion}</p>
                            <button onclick="editarCliente('${childSnapshot.key}')" class="mt-2 bg-yellow-500 text-white px-2 py-1 rounded hover:bg-yellow-600 transition duration-300">Editar</button>
                            <button onclick="eliminarCliente('${childSnapshot.key}')" class="mt-2 bg-red-500 text-white px-2 py-1 rounded hover:bg-red-600 transition duration-300">Eliminar</button>
                        `;
                        clientesContainer.appendChild(clienteElement);
                    });
                } else {
                    clientesContainer.innerHTML = '<p>No hay clientes registrados.</p>';
                }
            });
        }

        function cargarProductos() {
            const productosContainer = document.getElementById('lista-productos');
            productosContainer.innerHTML = '';
            database.ref('productos').once('value', (snapshot) => {
                if (snapshot.exists()) {
                    snapshot.forEach((childSnapshot) => {
                        const producto = childSnapshot.val();
                        const productoElement = document.createElement('div');
                        productoElement.className = 'bg-gray-100 p-4 rounded mb-2';
                        productoElement.innerHTML = `
                            <p><strong>Nombre:</strong> ${producto.nombre}</p>
                            <p><strong>Precio:</strong> $${producto.precio.toFixed(2)}</p>
                            <p><strong>Descripción:</strong> ${producto.descripcion}</p>
                            <img src="${producto.imagen}" alt="${producto.nombre}" class="w-32 h-32 object-cover mt-2">
                            <button onclick="editarProducto('${childSnapshot.key}')" class="mt-2 bg-yellow-500 text-white px-2 py-1 rounded hover:bg-yellow-600 transition duration-300">Editar</button>
                            <button onclick="eliminarProducto('${childSnapshot.key}')" class="mt-2 bg-red-500 text-white px-2 py-1 rounded hover:bg-red-600 transition duration-300">Eliminar</button>
                        `;
                        productosContainer.appendChild(productoElement);
                    });
                } else {
                    productosContainer.innerHTML = '<p>No hay productos en la tienda.</p>';
                }
            });
        }

        function cargarInventario() {
            const inventarioContainer = document.getElementById('lista-inventario');
            inventarioContainer.innerHTML = '';
            database.ref('inventario').once('value', (snapshot) => {
                if (snapshot.exists()) {
                    snapshot.forEach((childSnapshot) => {
                        const item = childSnapshot.val();
                        const itemElement = document.createElement('div');
                        itemElement.className = 'bg-gray-100 p-4 rounded mb-2';
                        itemElement.innerHTML = `
                            <p><strong>Nombre:</strong> ${item.nombre}</p>
                            <p><strong>Cantidad:</strong> ${item.cantidad}</p>
                            <p><strong>Precio de Compra:</strong> $${item.precio.toFixed(2)}</p>
                            <button onclick="editarInventario('${childSnapshot.key}')" class="mt-2 bg-yellow-500 text-white px-2 py-1 rounded hover:bg-yellow-600 transition duration-300">Editar</button>
                            <button onclick="eliminarInventario('${childSnapshot.key}')" class="mt-2 bg-red-500 text-white px-2 py-1 rounded hover:bg-red-600 transition duration-300">Eliminar</button>
                        `;
                        inventarioContainer.appendChild(itemElement);
                    });
                } else {
                    inventarioContainer.innerHTML = '<p>No hay items en el inventario.</p>';
                }
            });
        }

        function cargarServicios() {
            const serviciosContainer = document.getElementById('lista-servicios');
            serviciosContainer.innerHTML = '';
            database.ref('servicios').once('value', (snapshot) => {
                if (snapshot.exists()) {
                    snapshot.forEach((childSnapshot) => {
                        const servicio = childSnapshot.val();
                        const servicioElement = document.createElement('div');
                        servicioElement.className = 'bg-gray-100 p-4 rounded mb-2';
                        servicioElement.innerHTML = `
                            <p><strong>Nombre:</strong> ${servicio.nombre}</p>
                            <p><strong>Precio:</strong> $${servicio.precio.toFixed(2)}</p>
                            <p><strong>Descripción:</strong> ${servicio.descripcion}</p>
                            <button onclick="editarServicio('${childSnapshot.key}')" class="mt-2 bg-yellow-500 text-white px-2 py-1 rounded hover:bg-yellow-600 transition duration-300">Editar</button>
                            <button onclick="eliminarServicio('${childSnapshot.key}')" class="mt-2 bg-red-500 text-white px-2 py-1 rounded hover:bg-red-600 transition duration-300">Eliminar</button>
                        `;
                        serviciosContainer.appendChild(servicioElement);
                    });
                } else {
                    serviciosContainer.innerHTML = '<p>No hay servicios registrados.</p>';
                }
            });
        }

        function cargarExpedientes() {
            const expedientesContainer = document.getElementById('lista-expedientes');
            expedientesContainer.innerHTML = '';
            database.ref('clientes').once('value', (snapshot) => {
                if (snapshot.exists()) {
                    snapshot.forEach((childSnapshot) => {
                        const cliente = childSnapshot.val();
                        const expedienteElement = document.createElement('div');
                        expedienteElement.className = 'bg-white rounded-lg shadow-md p-6';
                        expedienteElement.innerHTML = `
                            <div class="flex items-center mb-4">
                                <img src="${cliente.fotoPerfil || 'img/default-profile.png'}" alt="${cliente.nombre}" class="w-16 h-16 rounded-full mr-4">
                                <div>
                                    <h3 class="text-xl font-semibold">${cliente.nombre}</h3>
                                    <p class="text-gray-600">${cliente.email}</p>
                                </div>
                            </div>
                            <h4 class="font-semibold mb-2">Mascotas:</h4>
                            <ul class="list-disc list-inside mb-4" id="mascotas-${childSnapshot.key}"></ul>
                            <button onclick="agregarNota('${childSnapshot.key}')" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 transition duration-300">Agregar Nota</button>
                            <button onclick="agregarFoto('${childSnapshot.key}')" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600 transition duration-300 ml-2">Agregar Foto</button>
                        `;
                        expedientesContainer.appendChild(expedienteElement);
                        cargarMascotas(childSnapshot.key);
                    });
                } else {
                    expedientesContainer.innerHTML = '<p>No hay expedientes registrados.</p>';
                }
            });
        }

        function cargarMascotas(clienteId) {
            const mascotasContainer = document.getElementById(`mascotas-${clienteId}`);
            database.ref('mascotas').orderByChild('clienteId').equalTo(clienteId).once('value', (snapshot) => {
                if (snapshot.exists()) {
                    snapshot.forEach((childSnapshot) => {
                        const mascota = childSnapshot.val();
                        const mascotaElement = document.createElement('li');
                        mascotaElement.textContent = mascota.nombre;
                        mascotasContainer.appendChild(mascotaElement);
                    });
                } else {
                    mascotasContainer.innerHTML = '<li>No hay mascotas registradas</li>';
                }
            });
        }

        document.getElementById('form-cliente').addEventListener('submit', function(e) {
            e.preventDefault();
            const nombre = document.getElementById('cliente-nombre').value;
            const email = document.getElementById('cliente-email').value;
            const telefono = document.getElementById('cliente-telefono').value;
            const fijo = document.getElementById('cliente-fijo').value;
            const direccion = document.getElementById('cliente-direccion').value;

            if (!nombre || !email || !telefono || !direccion) {
                Swal.fire('Error', 'Por favor, complete todos los campos obligatorios', 'error');
                return;
            }

            if (!/^[a-zA-ZáéíóúÁÉÍÓÚñÑ\s]+$/.test(nombre)) {
                Swal.fire('Error', 'El nombre solo debe contener letras y espacios', 'error');
                return;
            }

            if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
                Swal.fire('Error', 'Por favor, ingrese un email válido', 'error');
                return;
            }

            if (!/^[0-9]{10}$/.test(telefono)) {
                Swal.fire('Error', 'El número de teléfono debe tener 10 dígitos', 'error');
                return;
            }

            if (fijo && !/^[0-9]{10}$/.test(fijo)) {
                Swal.fire('Error', 'El número fijo debe tener 10 dígitos', 'error');
                return;
            }

            database.ref('clientes').push({
                nombre: nombre,
                email: email,
                telefono: telefono,
                fijo: fijo,
                direccion: direccion
            }).then(() => {
                Swal.fire('Éxito', 'Cliente agregado correctamente', 'success');
                document.getElementById('form-cliente').reset();
                cargarClientes();
            }).catch((error) => {
                Swal.fire('Error', 'No se pudo agregar el cliente: ' + error.message, 'error');
            });
        });

        document.getElementById('form-producto').addEventListener('submit', function(e) {
            e.preventDefault();
            const nombre = document.getElementById('producto-nombre').value;
            const precio = parseFloat(document.getElementById('producto-precio').value);
            const descripcion = document.getElementById('producto-descripcion').value;
            const imagen = document.getElementById('producto-imagen').files[0];

            if (!nombre || !precio || !descripcion || !imagen) {
                Swal.fire('Error', 'Por favor, complete todos los campos', 'error');
                return;
            }

            if (precio < 0.01 || precio > 1500) {
                Swal.fire('Error', 'El precio debe estar entre $0.01 y $1500', 'error');
                return;
            }

            if (imagen) {
                const storageRef = storage.ref('productos/' + imagen.name);
                storageRef.put(imagen).then((snapshot) => {
                    snapshot.ref.getDownloadURL().then((downloadURL) => {
                        database.ref('productos').push({
                            nombre: nombre,
                            precio: precio,
                            descripcion: descripcion,
                            imagen: downloadURL
                        }).then(() => {
                            Swal.fire('Éxito', 'Producto agregado correctamente', 'success');
                            document.getElementById('form-producto').reset();
                            cargarProductos();
                        }).catch((error) => {
                            Swal.fire('Error', 'No se pudo agregar el producto: ' + error.message, 'error');
                        });
                    });
                });
            } else {
                Swal.fire('Error', 'Por favor, seleccione una imagen para el producto', 'error');
            }
        });

        document.getElementById('form-inventario').addEventListener('submit', function(e) {
            e.preventDefault();
            const nombre = document.getElementById('inventario-nombre').value;
            const cantidad = parseInt(document.getElementById('inventario-cantidad').value);
            const precio = parseFloat(document.getElementById('inventario-precio').value);

            if (!nombre || !cantidad || !precio) {
                Swal.fire('Error', 'Por favor, complete todos los campos', 'error');
                return;
            }

            if (cantidad < 1) {
                Swal.fire('Error', 'La cantidad debe ser al menos 1', 'error');
                return;
            }

            if (precio < 0.01 || precio > 1500) {
                Swal.fire('Error', 'El precio debe estar entre $0.01 y $1500', 'error');
                return;
            }

            database.ref('inventario').push({
                nombre: nombre,
                cantidad: cantidad,
                precio: precio
            }).then(() => {
                Swal.fire('Éxito', 'Item agregado al inventario correctamente', 'success');
                document.getElementById('form-inventario').reset();
                cargarInventario();
            }).catch((error) => {
                Swal.fire('Error', 'No se pudo agregar el item al inventario: ' + error.message, 'error');
            });
        });

        document.getElementById('form-servicio').addEventListener('submit', function(e) {
            e.preventDefault();
            const nombre = document.getElementById('servicio-nombre').value;
            const precio = parseFloat(document.getElementById('servicio-precio').value);
            const descripcion = document.getElementById('servicio-descripcion').value;

            if (!nombre || !precio || !descripcion) {
                Swal.fire('Error', 'Por favor, complete todos los campos', 'error');
                return;
            }

            if (precio < 0.01 || precio > 1500) {
                Swal.fire('Error', 'El precio debe estar entre $0.01 y $1500', 'error');
                return;
            }

            database.ref('servicios').push({
                nombre: nombre,
                precio: precio,
                descripcion: descripcion
            }).then(() => {
                Swal.fire('Éxito', 'Servicio agregado correctamente', 'success');
                document.getElementById('form-servicio').reset();
                cargarServicios();
            }).catch((error) => {
                Swal.fire('Error', 'No se pudo agregar el servicio: ' + error.message, 'error');
            });
        });

        document.getElementById('form-perfil').addEventListener('submit', function(e) {
            e.preventDefault();
            const nombre = document.getElementById('nombre').value;
            const especialidad = document.getElementById('especialidad').value;

            database.ref('usuarios/' + userId).update({
                nombre: nombre,
                especialidad: especialidad
            }).then(() => {
                Swal.fire('Éxito', 'Perfil actualizado correctamente', 'success');
                cargarDatosUsuario();
            }).catch((error) => {
                Swal.fire('Error', 'No se pudo actualizar el perfil: ' + error.message, 'error');
            });
        });

        function subirFotoPerfil(event) {
            const file = event.target.files[0];
            if (file) {
                const storageRef = storage.ref('fotos_perfil/' + userId);
                storageRef.put(file).then((snapshot) => {
                    snapshot.ref.getDownloadURL().then((downloadURL) => {
                        database.ref('usuarios/' + userId).update({
                            fotoPerfil: downloadURL
                        }).then(() => {
                            document.getElementById('foto-perfil').src = downloadURL;
                            Swal.fire('Éxito', 'Foto de perfil actualizada correctamente', 'success');
                        });
                    });
                }).catch((error) => {
                    Swal.fire('Error', 'No se pudo subir la foto de perfil: ' + error.message, 'error');
                });
            }
        }

        function atenderCita(citaId) {
            // Implementar lógica para atender la cita
            Swal.fire('Atender Cita', 'Funcionalidad en desarrollo', 'info');
        }

        function reagendarCita(citaId) {
            database.ref('citas/' + citaId).once('value', (snapshot) => {
                const cita = snapshot.val();
                Swal.fire({
                    title: 'Reagendar Cita',
                    html:
                        `<input id="swal-input1" class="swal2-input" type="date" value="${cita.fecha}">` +
                        `<input id="swal-input2" class="swal2-input" type="time" value="${cita.hora}">`,
                    focusConfirm: false,
                    preConfirm: () => {
                        return {
                            fecha: document.getElementById('swal-input1').value,
                            hora: document.getElementById('swal-input2').value
                        }
                    }
                }).then((result) => {
                    if (result.isConfirmed) {
                        database.ref('citas/' + citaId).update(result.value).then(() => {
                            Swal.fire('Éxito', 'Cita reagendada correctamente', 'success');
                            cargarCitas();
                            enviarMensaje(cita.usuarioId, 'Su cita ha sido reagendada para ' + result.value.fecha + ' a las ' + result.value.hora);
                        }).catch((error) => {
                            Swal.fire('Error', 'No se pudo reagendar la cita: ' + error.message, 'error');
                        });
                    }
                });
            });
        }

        function cancelarCita(citaId) {
            Swal.fire({
                title: '¿Estás seguro?',
                text: "¿Quieres cancelar esta cita?",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Sí, cancelar',
                cancelButtonText: 'No, mantener'
            }).then((result) => {
                if (result.isConfirmed) {
                    database.ref('citas/' + citaId).once('value', (snapshot) => {
                        const cita = snapshot.val();
                        database.ref('citas/' + citaId).remove().then(() => {
                            Swal.fire('Cancelada', 'La cita ha sido cancelada.', 'success');
                            cargarCitas();
                            enviarMensaje(cita.usuarioId, 'Su cita para el ' + cita.fecha + ' a las ' + cita.hora + ' ha sido cancelada.');
                        }).catch((error) => {
                            Swal.fire('Error', 'No se pudo cancelar la cita: ' + error.message, 'error');
                        });
                    });
                }
            });
        }

        function enviarMensaje(usuarioId, mensaje) {
            database.ref('mensajes/' + usuarioId).push({
                contenido: mensaje,
                fecha: new Date().toISOString(),
                leido: false
            }).then(() => {
                console.log('Mensaje enviado correctamente');
            }).catch((error) => {
                console.error('Error al enviar mensaje:', error);
            });
        }

        function editarCliente(clienteId) {
            database.ref('clientes/' + clienteId).once('value', (snapshot) => {
                const cliente = snapshot.val();
                Swal.fire({
                    title: 'Editar Cliente',
                    html:
                        `<input id="swal-input1" class="swal2-input" placeholder="Nombre" value="${cliente.nombre}">` +
                        `<input id="swal-input2" class="swal2-input" placeholder="Email" value="${cliente.email}">` +
                        `<input id="swal-input3" class="swal2-input" placeholder="Teléfono" value="${cliente.telefono}">` +
                        `<input id="swal-input4" class="swal2-input" placeholder="Fijo" value="${cliente.fijo || ''}">` +
                        `<input id="swal-input5" class="swal2-input" placeholder="Dirección" value="${cliente.direccion}">`,
                    focusConfirm: false,
                    preConfirm: () => {
                        return {
                            nombre: document.getElementById('swal-input1').value,
                            email: document.getElementById('swal-input2').value,
                            telefono: document.getElementById('swal-input3').value,
                            fijo: document.getElementById('swal-input4').value,
                            direccion: document.getElementById('swal-input5').value
                        }
                    }
                }).then((result) => {
                    if (result.isConfirmed) {
                        database.ref('clientes/' + clienteId).update(result.value).then(() => {
                            Swal.fire('Éxito', 'Cliente actualizado correctamente', 'success');
                            cargarClientes();
                        }).catch((error) => {
                            Swal.fire('Error', 'No se pudo actualizar el cliente: ' + error.message, 'error');
                        });
                    }
                });
            });
        }

        function eliminarCliente(clienteId) {
            Swal.fire({
                title: '¿Estás seguro?',
                text: "Esta acción no se puede deshacer",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Sí, eliminar',
                cancelButtonText: 'Cancelar'
            }).then((result) => {
                if (result.isConfirmed) {
                    database.ref('clientes/' + clienteId).remove().then(() => {
                        Swal.fire('Eliminado', 'El cliente ha sido eliminado.', 'success');
                        cargarClientes();
                    }).catch((error) => {
                        Swal.fire('Error', 'No se pudo eliminar el cliente: ' + error.message, 'error');
                    });
                }
            });
        }

        function editarProducto(productoId) {
            // Implementar lógica para editar producto
            Swal.fire('Editar Producto', 'Funcionalidad en desarrollo', 'info');
        }

        function eliminarProducto(productoId) {
            Swal.fire({
                title: '¿Estás seguro?',
                text: "Esta acción no se puede deshacer",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Sí, eliminar',
                cancelButtonText: 'Cancelar'
            }).then((result) => {
                if (result.isConfirmed) {
                    database.ref('productos/' + productoId).remove().then(() => {
                        Swal.fire('Eliminado', 'El producto ha sido eliminado.', 'success');
                        cargarProductos();
                    }).catch((error) => {
                        Swal.fire('Error', 'No se pudo eliminar el producto: ' + error.message, 'error');
                    });
                }
            });
        }

        function editarInventario(itemId) {
            // Implementar lógica para editar item del inventario
            Swal.fire('Editar Inventario', 'Funcionalidad en desarrollo', 'info');
        }

        function eliminarInventario(itemId) {
            Swal.fire({
                title: '¿Estás seguro?',
                text: "Esta acción no se puede deshacer",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Sí, eliminar',
                cancelButtonText: 'Cancelar'
            }).then((result) => {
                if (result.isConfirmed) {
                    database.ref('inventario/' + itemId).remove().then(() => {
                        Swal.fire('Eliminado', 'El item ha sido eliminado del inventario.', 'success');
                        cargarInventario();
                    }).catch((error) => {
                        Swal.fire('Error', 'No se pudo eliminar el item del inventario: ' + error.message, 'error');
                    });
                }
            });
        }

        function editarServicio(servicioId) {
            // Implementar lógica para editar servicio
            Swal.fire('Editar Servicio', 'Funcionalidad en desarrollo', 'info');
        }

        function eliminarServicio(servicioId) {
            Swal.fire({
                title: '¿Estás seguro?',
                text: "Esta acción no se puede deshacer",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Sí, eliminar',
                cancelButtonText: 'Cancelar'
            }).then((result) => {
                if (result.isConfirmed) {
                    database.ref('servicios/' + servicioId).remove().then(() => {
                        Swal.fire('Eliminado', 'El servicio ha sido eliminado.', 'success');
                        cargarServicios();
                    }).catch((error) => {
                        Swal.fire('Error', 'No se pudo eliminar el servicio: ' + error.message, 'error');
                    });
                }
            });
        }

        function agregarNota(clienteId) {
            Swal.fire({
                title: 'Agregar Nota',
                input: 'textarea',
                inputPlaceholder: 'Escribe tu nota aquí...',
                showCancelButton: true,
                confirmButtonText: 'Guardar',
                cancelButtonText: 'Cancelar'
            }).then((result) => {
                if (result.isConfirmed) {
                    database.ref('notas/' + clienteId).push({
                        contenido: result.value,
                        fecha: new Date().toISOString()
                    }).then(() => {
                        Swal.fire('Éxito', 'Nota agregada correctamente', 'success');
                    }).catch((error) => {
                        Swal.fire('Error', 'No se pudo agregar la nota: ' + error.message, 'error');
                    });
                }
            });
        }

        function agregarFoto(clienteId) {
            Swal.fire({
                title: 'Agregar Foto',
                input: 'file',
                inputAttributes: {
                    'accept': 'image/*',
                    'aria-label': 'Sube una foto'
                }
            }).then((result) => {
                if (result.value) {
                    const file = result.value;
                    const storageRef = storage.ref('fotos_expediente/' + clienteId + '/' + file.name);
                    
                    storageRef.put(file).then((snapshot) => {
                        snapshot.ref.getDownloadURL().then((downloadURL) => {
                            database.ref('fotos/' + clienteId).push({
                                url: downloadURL,
                                fecha: new Date().toISOString()
                            }).then(() => {
                                Swal.fire('Éxito', 'Foto agregada correctamente', 'success');
                            });
                        });
                    }).catch((error) => {
                        Swal.fire('Error', 'No se pudo subir la foto: ' + error.message, 'error');
                    });
                }
            });
        }

        function cerrarSesion() {
            auth.signOut().then(() => {
                window.location.href = 'iniciarS.html';
            }).catch((error) => {
                console.error('Error al cerrar sesión:', error);
            });
        }
    </script>
</body>
</html>
